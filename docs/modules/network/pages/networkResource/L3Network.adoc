= 三层网络

目前支持的网络类型有: 公有网络, 扁平网络，VPC网络

[NOTE]
本章节只要是云主机的业务网络类型，其他网络类型：如迁移网络，管理网络等在相关章节介绍。

|===
|网络类型 |应用场景

|公有网络
|可以直接和数据中心外部互通的网络

|扁平网络
|可以直接和数据中心物理网络互通的网络

|VPC网络
|用来隔离租户云主机的网络，通过VPC路由器和数据中心外部互通

|===

== 创建三层网络

创建3层网络需要指定一个二层网络，然后配置IP地址段。ZStack支持IPv4和IPv6

* 三层网络如果配置IPv4地址段，就是一个IPV4网络
* 三层网络如果配置IPv6地址段，就是一个IPV6网络
* 三层网络如果配置IPv4地址段和IPv6地址段，就是一个双栈网络

image::l3/createL3Network.png[]

[NOTE]
建议一个二层网络只创建一个三层网络，如果一个二层网络多个三层网络，且三层网络的cidr相同，会导致userdata服务，vm内部监控等功能不能正常工作。

== IP地址段

=== 普通IP地址段
扁平网络和VPC网络，可以配置一个cidr, 或者多个IP地址段，但是要求多个地址段必须在一个cidr范围内。

=== 地址池地址段
公有网络除了可以配置普通IP地址段，还可以配置地址池地址段。
由很多网络服务(比如弹性IP，端口转发，负载均衡，IPSec)需要使用公网地址，因此，可能会出现公网地址耗尽的问题。
为了解决这个问题，可以给公网分配额外的地址段。

image::l3/ipAddressPool.png[]

[quote]
.使用地址还能带来节约IP地址的好处
____
假设创建一个新的公网把，IP地址池作为普通IP地址段，然后这个公网加载到VPC路由器，这样必然会占用如下地址:

* 网关地址
* 掩码地址
* 网络地址
* VPC的接口地址
____

[NOTE]
地址池地址段的Cidr和普通地址段的Cidr不同，因此需要用户在物理路由器上解决路由问题。


== 数据路径

公有网络和扁平网络一般都是使用NoVlan或者Vlan类型的二层网络创建的三层网络，它们的的数据路径类型如图所示，云主机的流量经过物理机网卡直接进入数据中心网络，进行路由转发。

image::l3/publicDataPath.svg[]

VPC网络可以使用任意类型的二层网络创建，它的的数据路径类型如图所示，云主机的流量经过会先转发给VPC路由器，由VPC路由转发到公有网络

image::l3/vpcDataPath.svg[]





